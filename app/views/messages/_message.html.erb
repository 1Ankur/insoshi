<% msg_class = (message.eql?(@messages.last())) ? 'message last' : 'message' %>
<li class="<%= msg_class -%>">
  <div class="profile-image">
    <% other_person = current_person?(message.sender) ?
                      message.recipient : message.sender %>
    <%= image_link other_person, :image => :thumbnail,
                   :image_options => { :class => "photo" } %>
  </div>
  <p>
    <span class="label">Subject:</span>
    <%= link_to sanitize(message.subject), message %>
  </p>
  <p>
    <%- if not message.read? and not current_person?(message.sender) -%>
      <%= image_tag("icons/email.png", :class => "icon") %>
    <%- elsif message.replied_to? -%>
      <%= image_tag("icons/email-go.png", :class => "icon" )  %>
    <%- end -%>    
    <%- if current_person?(message.sender) -%>
      <span class="label">To:</span>
      <%= person_link message.recipient, :class => "url fn" %>
    <%- else -%>
      <span class="label">From:</span>
      <%= person_link message.sender, :class => "url fn" %>
    <%- end -%>
<br />
  <span class="tools meta">
  Sent <%= time_ago_in_words message.created_at %> ago 
    <%= link_to(image_tag("icons/email_go.png", :class => 'actioner'), 
                      reply_message_path(message),
             :title => "Reply to this message") %>
    <% unless message.trashed?(current_person) -%>
      <%= link_to(image_tag("icons/email_delete.png", :class => 'actioner'), 
                        message_path(message), 
                        :method => :delete, 
                        :confirm => %(Delete this message?),
             :title => "Delete this message") %>
    <% else -%>
      <%= link_to "Untrash", undestroy_message_path(message), 
                             :method => :put %>
    <% end -%>    
  </span>
</p><div class="clear"></div>
</li>